
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>topics_and_summary.visualizations &#8212; Topics and Summary  documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Topics and Summary  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for topics_and_summary.visualizations</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">bokeh.plotting</span> <span class="k">as</span> <span class="nn">bp</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="k">import</span> <span class="n">HoverTool</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="k">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="k">import</span> <span class="n">TSNE</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="k">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="k">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">STOPWORDS</span>

<span class="kn">from</span> <span class="nn">topics_and_summary.models.topics</span> <span class="k">import</span> <span class="n">Topic</span><span class="p">,</span> <span class="n">TopicsModel</span>
<span class="kn">from</span> <span class="nn">topics_and_summary.utils</span> <span class="k">import</span> <span class="n">RANDOM_STATE</span><span class="p">,</span> <span class="n">now_as_str</span><span class="p">,</span> <span class="n">join_paths</span><span class="p">,</span> <span class="n">get_abspath_from_project_source_root</span>


<div class="viewcode-block" id="plot_distribution_of_doc_word_counts"><a class="viewcode-back" href="../../api/topics_and_summary.visualizations.html#topics_and_summary.visualizations.plot_distribution_of_doc_word_counts">[docs]</a><span class="k">def</span> <span class="nf">plot_distribution_of_doc_word_counts</span><span class="p">(</span><span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a histogram of the number of words in the documents.</span>

<span class="sd">    :param documents: : List[List[str]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">docs_word_counts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">]</span>

    <span class="c1"># Histogram</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">docs_word_counts</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="s2">&quot;Mean   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">docs_word_counts</span><span class="p">))))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span> <span class="s2">&quot;Median : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">docs_word_counts</span><span class="p">))))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;Stdev   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">docs_word_counts</span><span class="p">))))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="s2">&quot;1</span><span class="si">%i</span><span class="s2">le    : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">docs_word_counts</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.01</span><span class="p">))))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="s2">&quot;99</span><span class="si">%i</span><span class="s2">le  : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">docs_word_counts</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.99</span><span class="p">))))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Number of Documents&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Document Word Count&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution of Document Word Counts&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_word_clouds_of_topic"><a class="viewcode-back" href="../../api/topics_and_summary.visualizations.html#topics_and_summary.visualizations.plot_word_clouds_of_topic">[docs]</a><span class="k">def</span> <span class="nf">plot_word_clouds_of_topic</span><span class="p">(</span><span class="n">topic</span><span class="p">:</span> <span class="n">Topic</span><span class="p">,</span> <span class="n">all_horizontal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dir_save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">350</span><span class="p">,</span>
                              <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the specified topic and it&#39;s keywords as a word-cloud.</span>

<span class="sd">    :param topic: Topic obtained with the get_topic() method of the TopicsModel class.</span>
<span class="sd">    :param all_horizontal: If True, all the keywords are plotted in horizontal.</span>
<span class="sd">    :param save: If true, the plots are saved to disk.</span>
<span class="sd">    :param dir_save_path: If save is True, this is the path of the directory where the plots will be saved.</span>
<span class="sd">    :param dpi: Dots per inches for the images.</span>
<span class="sd">    :param show_plot: If true, shows the plot while executing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_word_clouds_of_topics</span><span class="p">([</span><span class="n">topic</span><span class="p">],</span> <span class="n">single_plot_per_topic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">all_horizontal</span><span class="o">=</span><span class="n">all_horizontal</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
                               <span class="n">dir_save_path</span><span class="o">=</span><span class="n">dir_save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="n">show_plot</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_word_clouds_of_topics"><a class="viewcode-back" href="../../api/topics_and_summary.visualizations.html#topics_and_summary.visualizations.plot_word_clouds_of_topics">[docs]</a><span class="k">def</span> <span class="nf">plot_word_clouds_of_topics</span><span class="p">(</span><span class="n">topics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Topic</span><span class="p">],</span> <span class="n">single_plot_per_topic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">all_horizontal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dir_save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">350</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the specified topics and it&#39;s keywords as word-clouds.</span>

<span class="sd">    :param topics: Topics obtained with the get_topics() method of the TopicsModel class.</span>
<span class="sd">    :param single_plot_per_topic: If True, each topic is plotted in a separated plot. \</span>
<span class="sd">    If False, each plot contains 4 topics.</span>
<span class="sd">    :param all_horizontal: If True, all the keywords are plotted in horizontal.</span>
<span class="sd">    :param save: If true, the plots are saved to disk.</span>
<span class="sd">    :param dir_save_path: If save is True, this is the path of the directory where the plots will be saved.</span>
<span class="sd">    :param dpi: Dots per inches for the images.</span>
<span class="sd">    :param show_plot: If true, shows the plot while executing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;topics param can&#39;t be an empty list&quot;</span><span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">TABLEAU_COLORS</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>  <span class="c1"># List of colors</span>
    <span class="c1"># Index of the current topic to be plotted.</span>
    <span class="c1"># Is used also for selecting the color for that topic in the function below.</span>
    <span class="n">topic_index</span> <span class="o">=</span> <span class="n">topics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>

    <span class="k">def</span> <span class="nf">color_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">colors</span><span class="p">[</span><span class="n">topic_index</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">all_horizontal</span><span class="p">:</span>
        <span class="n">prefer_horizontal</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefer_horizontal</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="n">cloud</span> <span class="o">=</span> <span class="n">WordCloud</span><span class="p">(</span><span class="n">stopwords</span><span class="o">=</span><span class="n">STOPWORDS</span><span class="p">,</span>
                      <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                      <span class="n">width</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span>
                      <span class="n">height</span><span class="o">=</span><span class="mi">1800</span><span class="p">,</span>
                      <span class="n">max_words</span><span class="o">=</span><span class="n">topics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">num_keywords</span><span class="p">(),</span>
                      <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span>
                      <span class="n">color_func</span><span class="o">=</span><span class="n">color_func</span><span class="p">,</span>
                      <span class="n">prefer_horizontal</span><span class="o">=</span><span class="n">prefer_horizontal</span><span class="p">)</span>

    <span class="n">num_topics_plotted</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_iterations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="k">if</span> <span class="n">single_plot_per_topic</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">):</span>
        <span class="c1"># Each topic is plotted in a separate plot</span>
        <span class="k">if</span> <span class="n">single_plot_per_topic</span><span class="p">:</span>
            <span class="n">topic</span> <span class="o">=</span> <span class="n">topics</span><span class="p">[</span><span class="n">num_topics_plotted</span><span class="p">]</span>
            <span class="n">topic_index</span> <span class="o">=</span> <span class="n">topic</span><span class="o">.</span><span class="n">id</span>
            <span class="n">topic_kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">topic</span><span class="o">.</span><span class="n">as_list_of_tuples</span><span class="p">())</span>
            <span class="c1"># Process finished with exit code 139 (interrupted by signal 11: SIGSEGV) when LSAModel is used below</span>
            <span class="n">cloud</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">topic_kws</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Topic &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic_index</span><span class="p">),</span> <span class="n">fontdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="n">num_topics_plotted</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Each plot contains, as max, 4 topics</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Each plot is formed by 4 subplots, each one containing the keywords of a topic</span>
            <span class="c1"># noinspection PyTypeChecker</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
                <span class="c1"># If all the topics have been plotted, and we are inside this for,</span>
                <span class="c1"># the current plot has less than 4 topic to show, so we remove the rest of the axes from the plot.</span>
                <span class="k">if</span> <span class="n">num_topics_plotted</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">topics</span><span class="p">):</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

                <span class="n">topic</span> <span class="o">=</span> <span class="n">topics</span><span class="p">[</span><span class="n">num_topics_plotted</span><span class="p">]</span>
                <span class="n">topic_index</span> <span class="o">=</span> <span class="n">topic</span><span class="o">.</span><span class="n">id</span>
                <span class="n">topic_kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">topic</span><span class="o">.</span><span class="n">as_list_of_tuples</span><span class="p">())</span>
                <span class="c1"># Process finished with exit code 139 (interrupted by signal 11: SIGSEGV) when LSAModel is used below</span>
                <span class="n">cloud</span><span class="o">.</span><span class="n">generate_from_frequencies</span><span class="p">(</span><span class="n">topic_kws</span><span class="p">,</span> <span class="n">max_font_size</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cloud</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Topic &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">topic_index</span><span class="p">),</span> <span class="n">fontdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

                <span class="n">num_topics_plotted</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">save_name</span> <span class="o">=</span> <span class="s1">&#39;wordcloud</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">plot_path</span> <span class="o">=</span> <span class="n">join_paths</span><span class="p">(</span><span class="n">dir_save_path</span><span class="p">,</span> <span class="n">save_name</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Avoid showing the plots when show_plot is False and plt.show() is called in another place</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>


<span class="n">_TSNE_SAVE_PATH</span> <span class="o">=</span> <span class="n">get_abspath_from_project_source_root</span><span class="p">(</span><span class="s1">&#39;saved-elements/topics/tsne&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="tsne_clustering_chart"><a class="viewcode-back" href="../../api/topics_and_summary.visualizations.html#topics_and_summary.visualizations.tsne_clustering_chart">[docs]</a><span class="k">def</span> <span class="nf">tsne_clustering_chart</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">TopicsModel</span><span class="p">,</span> <span class="n">angle</span><span class="o">=.</span><span class="mi">99</span><span class="p">,</span> <span class="n">doc_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                          <span class="n">plot_keywords</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_keywords</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">keywords_color_is_black</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use t-SNE technique for dimensionality reduction.</span>

<span class="sd">    :param model: Topics Model.</span>
<span class="sd">    :param angle: Number between 0 and 1. Angle less than 0.2 has quickly increasing computation \</span>
<span class="sd">    time and angle greater 0.8 has quickly increasing error.</span>
<span class="sd">    :param doc_threshold: Threshold that each document has to pass to be added to the plot.</span>
<span class="sd">    :param plot_keywords: If True, the keywords of each topic are plotted near a document of the topic.</span>
<span class="sd">    :param num_keywords: Number of keyword to show if plot_keywords is True.</span>
<span class="sd">    :param keywords_color_is_black: If true, the keywords color is black. If not, is the same color as the topic.</span>
<span class="sd">    :param save_path: Path where the html file with the interactive plot will be saved.</span>
<span class="sd">    :param plot_name: Name of the plot to be saved.</span>
<span class="sd">    :param show_plot: If true, opens a browser and shows the html with the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">_TSNE_SAVE_PATH</span>

    <span class="c1"># Get doc topic prob matrix</span>
    <span class="n">doc_topic_prob_matrix</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_doc_topic_prob_matrix</span><span class="p">()</span>

    <span class="c1"># Don&#39;t use docs that don&#39;t pass the threshold</span>
    <span class="n">_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">doc_topic_prob_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">doc_threshold</span>  <span class="c1"># idx of doc that above the threshold</span>
    <span class="n">doc_topic_prob_matrix</span> <span class="o">=</span> <span class="n">doc_topic_prob_matrix</span><span class="p">[</span><span class="n">_idx</span><span class="p">]</span>

    <span class="c1"># tSNE Dimension Reduction: 20-D -&gt; 2-D</span>
    <span class="c1"># n_components is the number of dimensions of the plot. n_components=2 -&gt; 2D</span>
    <span class="n">num_dimensions</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">tsne_model</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">num_dimensions</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_STATE</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">)</span>
    <span class="n">tsne_lda</span> <span class="o">=</span> <span class="n">tsne_model</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">doc_topic_prob_matrix</span><span class="p">)</span>

    <span class="c1"># Colors for the points in the Bokeh plot</span>
    <span class="n">colormap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="s2">&quot;#1f77b4&quot;</span><span class="p">,</span> <span class="s2">&quot;#aec7e8&quot;</span><span class="p">,</span> <span class="s2">&quot;#ff7f0e&quot;</span><span class="p">,</span> <span class="s2">&quot;#ffbb78&quot;</span><span class="p">,</span> <span class="s2">&quot;#2ca02c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#98df8a&quot;</span><span class="p">,</span> <span class="s2">&quot;#d62728&quot;</span><span class="p">,</span> <span class="s2">&quot;#ff9896&quot;</span><span class="p">,</span> <span class="s2">&quot;#9467bd&quot;</span><span class="p">,</span> <span class="s2">&quot;#c5b0d5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#8c564b&quot;</span><span class="p">,</span> <span class="s2">&quot;#c49c94&quot;</span><span class="p">,</span> <span class="s2">&quot;#e377c2&quot;</span><span class="p">,</span> <span class="s2">&quot;#f7b6d2&quot;</span><span class="p">,</span> <span class="s2">&quot;#7f7f7f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#c7c7c7&quot;</span><span class="p">,</span> <span class="s2">&quot;#bcbd22&quot;</span><span class="p">,</span> <span class="s2">&quot;#dbdb8d&quot;</span><span class="p">,</span> <span class="s2">&quot;#17becf&quot;</span><span class="p">,</span> <span class="s2">&quot;#9edae5&quot;</span>
    <span class="p">])</span>

    <span class="c1"># Get the most relevant topic for each doc</span>
    <span class="n">dominant_topic_per_doc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dominant_topic_prob_per_doc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dominant_topic_doc</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">doc_topic_prob_matrix</span><span class="p">):</span>
        <span class="n">dominant_topic_per_doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dominant_topic_doc</span><span class="o">.</span><span class="n">argmax</span><span class="p">())</span>
        <span class="n">dominant_topic_prob_per_doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dominant_topic_doc</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="c1"># Configure the default output state to generate output saved to a file when show() is called.</span>
    <span class="k">if</span> <span class="n">plot_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">now_as_str</span><span class="p">()</span>
        <span class="n">plot_name</span> <span class="o">=</span> <span class="s1">&#39;tsne_&#39;</span> <span class="o">+</span> <span class="n">now</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>

    <span class="n">bp</span><span class="o">.</span><span class="n">output_file</span><span class="p">(</span><span class="n">join_paths</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">plot_name</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>

    <span class="c1"># Create the plot for the Topic Clusters using Bokeh</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;t-SNE Clustering of </span><span class="si">{}</span><span class="s2"> LDA Topics&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">num_topics</span><span class="p">),</span>
                  <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;pan,wheel_zoom,box_zoom,reset,hover,previewsave&quot;</span><span class="p">,</span>  <span class="c1"># plot option tools</span>
                  <span class="n">plot_width</span><span class="o">=</span><span class="mi">1400</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>

    <span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span>
                 <span class="c1"># When source is provided, the kwargs above must refer to keys in the dict passed to source</span>
                 <span class="n">source</span><span class="o">=</span><span class="n">bp</span><span class="o">.</span><span class="n">ColumnDataSource</span><span class="p">({</span>
                     <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">tsne_lda</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">tsne_lda</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="s2">&quot;topic index&quot;</span><span class="p">:</span> <span class="n">dominant_topic_per_doc</span><span class="p">,</span>
                     <span class="s2">&quot;topic prob&quot;</span><span class="p">:</span> <span class="n">dominant_topic_prob_per_doc</span><span class="p">,</span>
                     <span class="s2">&quot;doc text&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">documents</span><span class="p">[:</span><span class="n">doc_topic_prob_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])),</span>
                     <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">colormap</span><span class="p">[</span><span class="n">dominant_topic_per_doc</span><span class="p">]</span>
                 <span class="p">}))</span>

    <span class="k">if</span> <span class="n">plot_keywords</span><span class="p">:</span>
        <span class="c1"># Plot the keywords for each topic:</span>

        <span class="c1"># Randomly choose a doc (within a topic) coordinate as the keywords coordinate</span>
        <span class="n">topic_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">doc_topic_prob_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_dimensions</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">for</span> <span class="n">topic_num</span> <span class="ow">in</span> <span class="n">dominant_topic_per_doc</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">topic_coord</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="k">break</span>
            <span class="n">topic_coord</span><span class="p">[</span><span class="n">topic_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsne_lda</span><span class="p">[</span><span class="n">dominant_topic_per_doc</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">topic_num</span><span class="p">)]</span>

        <span class="c1"># List of num_topics keywords as a str per each topic in the model</span>
        <span class="n">topics_kws</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">get_k_kws_of_topic_as_str</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">num_keywords</span><span class="p">)</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">num_topics</span><span class="p">)]</span>

        <span class="c1"># Plot the keywords</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">doc_topic_prob_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">keywords_color_is_black</span><span class="p">:</span>
                <span class="n">text_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#000000&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: The library doesn&#39;t allow to put a color in the contour,</span>
                <span class="c1">#  so this option doesn&#39;t let to visualize the words correctly</span>
                <span class="n">text_color</span> <span class="o">=</span> <span class="p">[</span><span class="n">colormap</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

            <span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s1">&#39;text_color&#39;</span><span class="p">,</span>
                      <span class="n">source</span><span class="o">=</span><span class="n">bp</span><span class="o">.</span><span class="n">ColumnDataSource</span><span class="p">({</span>
                          <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">topic_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                          <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">topic_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
                          <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">topics_kws</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                          <span class="s2">&quot;topic index&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span>
                          <span class="s2">&quot;text_color&quot;</span><span class="p">:</span> <span class="n">text_color</span>
                      <span class="p">}))</span>

    <span class="c1"># Add info box for each doc using hover tools</span>
    <span class="n">hover</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">HoverTool</span><span class="p">))</span>
    <span class="c1"># With @ we refer to keys in the source dict. If the key contains spaces, it must be specified like @{key name}</span>
    <span class="c1"># TODO: This shows this fields for all objects, including the text, that doesn&#39;t have all them, but I think</span>
    <span class="c1">#  there is no solution to this, or at least in the documentation they only explain how to apply tooltips to figure.</span>
    <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;doc_index&quot;</span><span class="p">,</span> <span class="s2">&quot;$index&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;topic_index&quot;</span><span class="p">,</span> <span class="s2">&quot;@{topic index}&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;topic_prob&quot;</span><span class="p">,</span> <span class="s2">&quot;@{topic prob}&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;doc_text&quot;</span><span class="p">,</span> <span class="s2">&quot;@{doc text}&quot;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">show_plot</span><span class="p">:</span>
        <span class="n">show</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>

    <span class="n">bp</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table of Contents</a></h3>
<p class="caption"><span class="caption-text">Documentation contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Development</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Topics and Summary  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Carlos Sanabria Miranda.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>